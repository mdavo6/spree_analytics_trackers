<script>
    if (typeof ga !== 'undefined') {
      <% products.each_with_index do |product, index| %>
        $('#<%= product.slug %>-link').click(function (event) {
          event.preventDefault();
          ga('ec:addProduct',
            <%= product_for_google(product, position: index+1) %>
          );
          ga('ec:setAction', 'click', { list: '<%= @taxon.name %>'});
          ga('send', 'event', 'UX', 'click', 'Results', {
            hitCallback: function() {
              Turbolinks.visit('<%= product_url(product, taxon_id: @taxon.try(:id)) %>');
            }
          });
        });
      <% end %>
    }
</script>
