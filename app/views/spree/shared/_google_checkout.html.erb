<%# more info: https://developers.google.com/analytics/devguides/collection/analyticsjs/enhanced-ecommerce %>
<script>
  if (typeof ga !== 'undefined') {

    // Added to prevent double counting of checkouts
    <% if @order.state == 'cart' %>
      <%= render partial: 'spree/shared/google_add_items', locals: { order: @order } %>
    <% end %>

    // Add the step number and additional info about the checkout to the action.
    ga('ec:setAction','checkout', {
      <% if @order.state == 'cart' %>
        'step': 1
      <% else %>
        'step': <%= (@order.checkout_steps.index(@order.state) + 2) %>
      <% end %>
    });
  }
</script>
